name: Bulk Convert Existing Images to WebP
on:
  workflow_dispatch: # This allows you to run it manually on existing files

jobs:
  webp-convert:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4

      - name: WebP Optimizer
        run: |
          # Install cwebp tool
          sudo apt-get update
          sudo apt-get install -y webp
          
          # Find and convert all images to WebP
          find . -type f \( -iname "*.jpg" -o -iname "*.jpeg" -o -iname "*.png" \) ! -path "./node_modules/*" ! -path "./.git/*" | while read file; do
            output="${file%.*}.webp"
            cwebp -q 80 "${file}" -o "${output}"
            echo "Converted: ${file} -> ${output}"
          done
          
          # Optionally remove original files (uncomment if desired)
          # find . -type f \( -iname "*.jpg" -o -iname "*.jpeg" -o -iname "*.png" \) ! -path "./node_modules/*" ! -path "./.git/*" -delete

      - name: Commit converted images
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add -A
          git commit -m "Convert images to WebP format" || echo "No changes to commit"
          git push
